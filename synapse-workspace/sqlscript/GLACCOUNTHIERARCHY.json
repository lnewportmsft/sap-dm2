{
	"name": "GLACCOUNTHIERARCHY",
	"properties": {
		"folder": {
			"name": "Hierarchy_View_Scripts"
		},
		"content": {
			"query": "SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE VIEW [dmgold].[GLACCOUNTHIERARCHY]\nAS WITH fhn (\n\t[glaccounthierarchy]\n\t,[parentnode]\n\t,[hierarchynode]\n\t,[ChartofAccounts]\n\t,[hierarchynodeval]\n\t,[glaccount]\n\t,[nodetype]\n    ,[key],[hierarchyversion]\n\t,[VALIDITYENDDATE],[VALIDITYSTARTDATE],[_SystemName]\n\t)\nAS (\n\tSELECT \th.[glaccounthierarchy]\n\t,h.[parentnode]\n\t,h.[hierarchynode]\n\t,h.[ChartofAccounts]\n\t,h.[hierarchynodeval]\n\t,h.[glaccount]\n\t,h.[nodetype]\n    ,h.[key],h.[hierarchyversion]\n\t,h.[VALIDITYENDDATE],h.[VALIDITYSTARTDATE],h.[_SystemName]\n\tFROM [dmgold].[i_glaccounthierarchynode] h\n\tWHERE h.[validityenddate] = '99991231'\n\tGROUP BY h.[glaccounthierarchy]\n\t,h.[parentnode]\n\t,h.[hierarchynode]\n\t,h.[ChartofAccounts]\n\t,h.[hierarchynodeval]\n\t,h.[glaccount]\n\t,h.[nodetype]\n    ,h.[key],h.[hierarchyversion]\n\t,h.[VALIDITYENDDATE],h.[VALIDITYSTARTDATE],h.[_SystemName]\n\t) (\n\t\tSELECT \n\t\tl1.[glaccounthierarchy]\n\t\t\t,(\n\t\t\t\tCASE \n\t\t\t\t\tWHEN l9.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l9.[chartofaccounts]\n\t\t\t\t\tWHEN l8.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l8.[chartofaccounts]\n\t\t\t\t\tWHEN l7.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l7.[chartofaccounts]\n\t\t\t\t\tWHEN l6.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l6.[chartofaccounts]\n\t\t\t\t\tWHEN l5.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l5.[chartofaccounts]\n\t\t\t\t\tWHEN l4.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l4.[chartofaccounts]\n\t\t\t\t\tWHEN l3.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l3.[chartofaccounts]\n\t\t\t\t\tWHEN l2.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l2.[chartofaccounts]\n\t\t\t\t\tWHEN l1.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l1.[chartofaccounts]\n\t\t\t\t\tEND\n\t\t\t\t) AS chartofaccounts\n\t\t\t,(\n\t\t\t\tCASE \n\t\t\t\t\tWHEN l9.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l9.[hierarchynode]\n\t\t\t\t\tWHEN l8.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l8.[hierarchynode]\n\t\t\t\t\tWHEN l7.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l7.[hierarchynode]\n\t\t\t\t\tWHEN l6.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l6.[hierarchynode]\n\t\t\t\t\tWHEN l5.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l5.[hierarchynode]\n\t\t\t\t\tWHEN l4.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l4.[hierarchynode]\n\t\t\t\t\tWHEN l3.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l3.[hierarchynode]\n\t\t\t\t\tWHEN l2.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l2.[hierarchynode]\n\t\t\t\t\tWHEN l1.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l1.[hierarchynode]\n\t\t\t\t\tEND\n\t\t\t\t) AS child\n\t\t\t,(\n\t\t\t\tCASE \n\t\t\t\t\tWHEN l9.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l9.[parentnode]\n\t\t\t\t\tWHEN l8.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l8.[parentnode]\n\t\t\t\t\tWHEN l7.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l7.[parentnode]\n\t\t\t\t\tWHEN l6.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l6.[parentnode]\n\t\t\t\t\tWHEN l5.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l5.[parentnode]\n\t\t\t\t\tWHEN l4.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l4.[parentnode]\n\t\t\t\t\tWHEN l3.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l3.[parentnode]\n\t\t\t\t\tWHEN l2.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l2.[parentnode]\n\t\t\t\t\tWHEN l1.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\tTHEN l1.[parentnode]\n\t\t\t\t\tEND\n\t\t\t\t) AS parent\n\t\t\t,/*(\n\t\t\t\t\tCASE \n\t\t\t\t\t\tWHEN l9.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l9.[key] -- l9.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l8.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l8.[key] -- l8.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l7.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l7.[key] -- l7.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l6.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l6.[key] -- l6.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l5.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l5.[key] -- l5.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l4.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l4.[key] -- l4.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l3.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l3.[key] -- l3.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l2.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l2.[key] -- l2.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l1.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l1.[key] -- l1.[hierarchynodeval]\n\t\t\t\t\t\tEND\n\t\t\t\t\t)\n\t\t\t\t--)\n                 AS [glaccount_node_key]*/\n\t\t\t(\n\t\t\t\t\tCASE \n\t\t\t\t\t\tWHEN l9.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l9.[hierarchyversion] -- l9.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l8.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l8.[hierarchyversion] -- l8.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l7.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l7.[hierarchyversion] -- l7.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l6.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l6.[hierarchyversion] -- l6.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l5.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l5.[hierarchyversion] -- l5.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l4.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l4.[hierarchyversion] -- l4.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l3.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l3.[hierarchyversion] -- l3.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l2.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l2.[hierarchyversion] -- l2.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l1.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l1.[hierarchyversion] -- l1.[hierarchynodeval]\n\t\t\t\t\t\tEND\n\t\t\t\t\t)\n\t\t\t\t--)\n                 AS [hierarchyversion]\n\t\t\t\t ,(\n\t\t\t\t\tCASE \n\t\t\t\t\t\tWHEN l9.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l9.[VALIDITYENDDATE] -- l9.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l8.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l8.[VALIDITYENDDATE] -- l8.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l7.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l7.[VALIDITYENDDATE] -- l7.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l6.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l6.[VALIDITYENDDATE] -- l6.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l5.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l5.[VALIDITYENDDATE] -- l5.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l4.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l4.[VALIDITYENDDATE] -- l4.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l3.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l3.[VALIDITYENDDATE] -- l3.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l2.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l2.[VALIDITYENDDATE] -- l2.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l1.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l1.[VALIDITYENDDATE] -- l1.[hierarchynodeval]\n\t\t\t\t\t\tEND\n\t\t\t\t\t)\n\t\t\t\t--)\n                 AS [VALIDITYENDDATE]\n\t\t\t\t ,(\n\t\t\t\t\tCASE \n\t\t\t\t\t\tWHEN l9.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l9.[VALIDITYSTARTDATE] -- l9.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l8.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l8.[VALIDITYSTARTDATE] -- l8.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l7.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l7.[VALIDITYSTARTDATE] -- l7.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l6.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l6.[VALIDITYSTARTDATE] -- l6.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l5.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l5.[VALIDITYSTARTDATE] -- l5.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l4.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l4.[VALIDITYSTARTDATE] -- l4.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l3.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l3.[VALIDITYSTARTDATE] -- l3.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l2.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l2.[VALIDITYSTARTDATE] -- l2.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l1.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l1.[VALIDITYSTARTDATE] -- l1.[hierarchynodeval]\n\t\t\t\t\t\tEND\n\t\t\t\t\t)\n\t\t\t\t--)\n                 AS [VALIDITYSTARTDATE]\n\t ,(\n\t\t\t\t\tCASE \n\t\t\t\t\t\tWHEN l9.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l9.[GLAccount] -- l9.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l8.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l8.[GLAccount] -- l8.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l7.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l7.[GLAccount] -- l7.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l6.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l6.[GLAccount] -- l6.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l5.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l5.[GLAccount] -- l5.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l4.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l4.[GLAccount] -- l4.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l3.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l3.[GLAccount] -- l3.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l2.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l2.[GLAccount] -- l2.[hierarchynodeval]\n\t\t\t\t\t\tWHEN l1.[hierarchynodeval] IS NOT NULL\n\t\t\t\t\t\t\tTHEN l1.[GLAccount] -- l1.[hierarchynodeval]\n\t\t\t\t\t\tEND\n\t\t\t\t\t)\n\t\t\t\t--)\n                 AS [GLAccount]\n\t\t\t,nullif(l1.[hierarchynodeval],NULL) AS level1\n\t\t\t,nullif(l1.[key],NULL) AS level1_key\n            --,nullif(concat_ws('|', coalesce(l1.[controllingarea], NULL), coalesce(l1.[hierarchynode], NULL)), '') AS level1_key\n\t\t\t,nullif(l2.[hierarchynodeval],NULL) AS level2\n\t\t\t,nullif(l2.[key],NULL) AS level2_key\n            --,nullif(concat_ws('|', coalesce(l2.[controllingarea], NULL), coalesce(l2.[hierarchynode], NULL)), '') AS level2_key\n\t\t\t,nullif(l3.[hierarchynodeval],NULL) AS level3\n\t\t\t,nullif(l3.[key],NULL) AS level3_key\n            --,nullif(concat_ws('|', coalesce(l3.[controllingarea], NULL), coalesce(l3.[hierarchynode], NULL)), '') AS level3_key\n\t\t\t,nullif(l4.[hierarchynodeval],NULL) AS level4\n\t\t\t,nullif(l4.[key],NULL) AS level4_key\n            --,nullif(concat_ws('|', coalesce(l4.[controllingarea], NULL), coalesce(l4.[hierarchynode], NULL)), '') AS level4_key\n\t\t\t,nullif(l5.[hierarchynodeval],NULL) AS level5\n\t\t\t,nullif(l5.[key],NULL) AS level5_key\n            --,nullif(concat_ws('|', coalesce(l5.[controllingarea], NULL), coalesce(l5.[hierarchynode], NULL)), '') AS level5_key\n\t\t\t,nullif(l6.[hierarchynodeval],NULL) AS level6\n\t\t\t,nullif(l6.[key],NULL) AS level6_key\n            --,nullif(concat_ws('|', coalesce(l6.[controllingarea], NULL), coalesce(l6.[hierarchynode], NULL)), '') AS level6_key\n\t\t\t,nullif(l7.[hierarchynodeval],NULL) AS level7\n\t\t\t,nullif(l7.[key],NULL) AS level7_key\n            --,nullif(concat_ws('|', coalesce(l7.[controllingarea], NULL), coalesce(l7.[hierarchynode], NULL)), '') AS level7_key\n\t\t\t,nullif(l8.[hierarchynodeval],NULL) AS level8\n\t\t\t,nullif(l8.[key],NULL) AS level8_key\n            --,nullif(concat_ws('|', coalesce(l8.[controllingarea], NULL), coalesce(l8.[hierarchynode], NULL)), '') AS level8_key\n\t\t\t,nullif(l9.[hierarchynodeval],NULL) AS level9\n\t\t\t,nullif(l9.[key],NULL) AS level9_key\n            --,nullif(concat_ws('|', coalesce(l9.[controllingarea], NULL), coalesce(l9.[hierarchynode], NULL)), '') AS level9_key\n\t\t\t,concat_ws('|', l1.[hierarchynodeval], l2.[hierarchynodeval], l3.[hierarchynodeval], l4.[hierarchynodeval], l5.[hierarchynodeval], l6.[hierarchynodeval], l7.[hierarchynodeval], l8.[hierarchynodeval], l9.[hierarchynodeval]) AS hierarchypath\n\t\t\t-- [TL]: Added to determine MAX Hierarchy Level \n            , LEN(CONCAT_WS ('|' ,L1.[HIERARCHYNODEVAL] ,L2.[HIERARCHYNODEVAL] ,L3.[HIERARCHYNODEVAL] ,L4.[HIERARCHYNODEVAL] ,L5.[HIERARCHYNODEVAL] ,L6.[HIERARCHYNODEVAL] ,L7.[HIERARCHYNODEVAL] ,L8.[HIERARCHYNODEVAL] ,L9.[HIERARCHYNODEVAL] )) - LEN(REPLACE(CONCAT_WS ('|' ,L1.[HIERARCHYNODEVAL] ,L2.[HIERARCHYNODEVAL] ,L3.[HIERARCHYNODEVAL] ,L4.[HIERARCHYNODEVAL] ,L5.[HIERARCHYNODEVAL] ,L6.[HIERARCHYNODEVAL] ,L7.[HIERARCHYNODEVAL] ,L8.[HIERARCHYNODEVAL] ,L9.[HIERARCHYNODEVAL] ), '|', '')) + 1 AS MaxHierarchyLevel \n\t\t\t,l1.[_SystemName]\n\t\t\tFROM FHN L1 LEFT OUTER JOIN FHN L2 ON \n            L1.[glaccounthierarchy] = L2.[glaccounthierarchy] AND L1.[HIERARCHYNODE] = L2.[PARENTNODE] \n            LEFT OUTER JOIN FHN L3 ON L2.[glaccounthierarchy] = L3.[glaccounthierarchy] AND L2.[HIERARCHYNODE] = L3.[PARENTNODE] \n            LEFT OUTER JOIN FHN L4 ON L3.[glaccounthierarchy] = L4.[glaccounthierarchy] AND L3.[HIERARCHYNODE] = L4.[PARENTNODE] \n            LEFT OUTER JOIN FHN L5 ON L4.[glaccounthierarchy] = L5.[glaccounthierarchy] AND L4.[HIERARCHYNODE] = L5.[PARENTNODE] \n            LEFT OUTER JOIN FHN L6 ON L5.[glaccounthierarchy] = L6.[glaccounthierarchy] AND L5.[HIERARCHYNODE] = L6.[PARENTNODE] \n            LEFT OUTER JOIN FHN L7 ON L6.[glaccounthierarchy] = L7.[glaccounthierarchy] AND L6.[HIERARCHYNODE] = L7.[PARENTNODE] \n            LEFT OUTER JOIN FHN L8 ON L7.[glaccounthierarchy] = L8.[glaccounthierarchy] AND L7.[HIERARCHYNODE] = L8.[PARENTNODE] \n            LEFT OUTER JOIN FHN L9 ON L8.[glaccounthierarchy] = L9.[glaccounthierarchy] AND L8.[HIERARCHYNODE] = L9.[PARENTNODE] \n            WHERE L1.nodetype = 'R'\n\t\t\t--L1.[PROFITCENTERHIERARCHY] = '0106/A000/YBPH'\n\t\t\t-- --'ZUS10_P_CL' )\n\t\t);\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "sapdmsqlpool",
				"poolName": "sapdmsqlpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}
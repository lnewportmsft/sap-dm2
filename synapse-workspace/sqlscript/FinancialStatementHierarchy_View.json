{
	"name": "FinancialStatementHierarchy_View",
	"properties": {
		"content": {
			"query": "CREATE VIEW [sap_master].[FINANCIALSTATEMENTHIERARCHY]\nAS\nWITH fhn (\n\t[financial_statement_hierarchy]\n\t,[parent_node]\n\t,[hierarchy_node]\n\t,[chart_of_accounts]\n\t,[hierarchy_node_val]\n\t,[financial_statement_leaf_item]\n    ,[key]\n\t)\nAS (\n\tSELECT H.[financial_statement_hierarchy]\n\t\t,H.[parent_node]\n\t\t,H.[hierarchy_node]\n\t\t,H.[chart_of_accounts]\n\t\t,H.[hierarchy_node_val]\n\t\t,H.[financial_statement_leaf_item]\n        ,[key]\n\tFROM [sap_master].[i_financialstatementhiernode] H\n\tWHERE H.[validity_end_date] = '99991231'\n\tGROUP BY H.[financial_statement_hierarchy]\n\t\t,H.[parent_node]\n\t\t,H.[hierarchy_node]\n\t\t,H.[chart_of_accounts]\n\t\t,H.[hierarchy_node_val]\n\t\t,H.[financial_statement_leaf_item]\n        ,[key]\n\t) (\n\t\tSELECT L1.[financial_statement_hierarchy]\n\t\t\t,(\n\t\t\t\tCASE \n\t\t\t\t\tWHEN L4.[hierarchy_node] IS NOT NULL\n\t\t\t\t\t\tTHEN L4.[hierarchy_node]\n\t\t\t\t\tWHEN L3.[hierarchy_node] IS NOT NULL\n\t\t\t\t\t\tTHEN L3.[hierarchy_node]\n\t\t\t\t\tWHEN L2.[hierarchy_node] IS NOT NULL\n\t\t\t\t\t\tTHEN L2.[hierarchy_node]\n\t\t\t\t\tWHEN L1.[hierarchy_node] IS NOT NULL\n\t\t\t\t\t\tTHEN L1.[hierarchy_node]\n\t\t\t\t\tEND\n\t\t\t\t) AS CHILD\n\t\t\t,(\n\t\t\t\tCASE \n\t\t\t\t\tWHEN L4.[hierarchy_node] IS NOT NULL\n\t\t\t\t\t\tTHEN L4.[parent_node]\n\t\t\t\t\tWHEN L3.[hierarchy_node] IS NOT NULL\n\t\t\t\t\t\tTHEN L3.[parent_node]\n\t\t\t\t\tWHEN L2.[hierarchy_node] IS NOT NULL\n\t\t\t\t\t\tTHEN L2.[parent_node]\n\t\t\t\t\tWHEN L1.[hierarchy_node] IS NOT NULL\n\t\t\t\t\t\tTHEN L1.[parent_node]\n\t\t\t\t\tEND\n\t\t\t\t) AS PARENT\n\t\t\t,(\n\t\t\t\tCASE \n\t\t\t\t\tWHEN L4.[financial_statement_leaf_item] IS NOT NULL\n\t\t\t\t\t\tTHEN L4.[chart_of_accounts]\n\t\t\t\t\tWHEN L3.[financial_statement_leaf_item] IS NOT NULL\n\t\t\t\t\t\tTHEN L3.[chart_of_accounts]\n\t\t\t\t\tWHEN L2.[financial_statement_leaf_item] IS NOT NULL\n\t\t\t\t\t\tTHEN L2.[chart_of_accounts]\n\t\t\t\t\tWHEN L1.[financial_statement_leaf_item] IS NOT NULL\n\t\t\t\t\t\tTHEN L1.[chart_of_accounts]\n\t\t\t\t\tEND\n\t\t\t\t) AS [Chart_of_Accounts]\n\t\t\t,(\n\t\t\t\tCASE \n\t\t\t\t\tWHEN (L4.[chart_of_accounts] <> '')\n\t\t\t\t\t\tTHEN L4.[hierarchy_node_val]\n\t\t\t\t\tWHEN (L3.[chart_of_accounts] <> '')\n\t\t\t\t\t\tTHEN L3.[hierarchy_node_val]\n\t\t\t\t\tWHEN (L2.[chart_of_accounts] <> '')\n\t\t\t\t\t\tTHEN L2.[hierarchy_node_val]\n\t\t\t\t\tWHEN (L1.[chart_of_accounts] <> '')\n\t\t\t\t\t\tTHEN L1.[hierarchy_node_val]\n\t\t\t\t\tEND\n\t\t\t\t) AS [HIERARCHY_NODE_VAL]\n\t\t\t,(\n\t\t\t\t\tCASE \n\t\t\t\t\t\tWHEN (L4.[chart_of_accounts] <> '')\n\t\t\t\t\t\t\tTHEN L4.[key]\n\t\t\t\t\t\tWHEN (L3.[chart_of_accounts] <> '')\n\t\t\t\t\t\t\tTHEN L3.[key]\n\t\t\t\t\t\tWHEN (L2.[chart_of_accounts] <> '')\n\t\t\t\t\t\t\tTHEN L2.[key]\n\t\t\t\t\t\tWHEN (L1.[chart_of_accounts] <> '')\n\t\t\t\t\t\t\tTHEN L.[key]\n\t\t\t\t\t\tEND\n\t\t\t\t) AS Financial_Statement_Hierarchy_Key\n\t\t\t,L1.[hierarchy_node] AS LEVEL1\n            ,L1.[key] AS LEVEL1_KEY\n--\t\t\t,Concat_ws('|', L1.[financial_statement_hierarchy], L1.[hierarchy_node]) AS LEVEL1_KEY\n\t\t\t,L2.[hierarchy_node] AS LEVEL2\n            ,L2.[key] AS LEVEL2_KEY\n--\t\t\t,Concat_ws('|', L2.[financial_statement_hierarchy], L2.[hierarchy_node]) AS LEVEL2_KEY\n\t\t\t,L3.[hierarchy_node] AS LEVEL3\n            ,L3.[key] AS LEVEL3_KEY\n--\t\t\t,Concat_ws('|', L3.[financial_statement_hierarchy], L3.[hierarchy_node]) AS LEVEL3_KEY\n\t\t\t,L4.[hierarchy_node] AS LEVEL4\n            ,L4.[key] AS LEVEL4_KEY\n--\t\t\t,Concat_ws('|', L4.[financial_statement_hierarchy], L4.[hierarchy_node]) AS LEVEL4_KEY\n\t\t\t,Concat_ws('|', L1.[hierarchy_node], L2.[hierarchy_node], L3.[hierarchy_node], L4.[hierarchy_node]) AS HierarchyPath\n\t\tFROM fhn L1\n\t\tLEFT OUTER JOIN fhn L2 ON L1.[financial_statement_hierarchy] = L2.[financial_statement_hierarchy]\n\t\t\tAND L1.[hierarchy_node] = L2.[parent_node]\n\t\tLEFT OUTER JOIN fhn L3 ON L2.[financial_statement_hierarchy] = L3.[financial_statement_hierarchy]\n\t\t\tAND L2.[hierarchy_node] = L3.[parent_node]\n\t\tLEFT OUTER JOIN fhn L4 ON L3.[financial_statement_hierarchy] = L4.[financial_statement_hierarchy]\n\t\t\tAND L3.[hierarchy_node] = L4.[parent_node]\n\t\tWHERE L1.parent_node = ' '\n\t\t)\n\nUNION ALL\n\nSELECT L0.[financial_statement_hierarchy]\n\t,L0.[hierarchy_node] AS CHILD\n\t,L0.[parent_node] AS PARENT\n\t,L0.[chart_of_accounts] AS Chart_of_Accounts\n\t,'' AS HIERARCHY_NODE_VAL\n/*\t,CONCAT (\n\t\tL0.[chart_of_accounts]\n\t\t,''\n\t\t)*/\n    ,L0.[key] AS Financial_Statement_Hierarchy_Key\n\t,L0.[hierarchy_node] AS LEVEL1\n\t,CONCAT (\n\t\tCOALESCE(L0.[financial_statement_hierarchy], '')\n\t\t,'|'\n\t\t,COALESCE(L0.[hierarchy_node], '')\n\t\t) AS LEVEL1_KEY\n\t,' ' AS LEVEL2\n\t,' ' AS LEVEL2_KEY\n\t,' ' AS LEVEL3\n\t,' ' AS LEVEL3_KEY\n\t,' ' AS LEVEL4\n\t,' ' AS LEVEL4_KEY\n\t,L0.[hierarchy_node] AS HierarchyPath\nFROM [sap_master].[i_financialstatementhiernode] L0\nWHERE L0.[validity_end_date] = '99991231' --AND L0.[FINANCIAL_STATEMENT_HIERARCHY] = '1720' AND L0.parent_node = ' '\n\t",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "sap_gold",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}